    const activateButton = document.getElementById('activate-button');
    const dataDisplay = document.getElementById('data-display');
    const gaugeNeedle = document.getElementById('gauge-needle');
    const volumeSlider = document.getElementById('volume-slider');
    const frequencyDisplay = document.getElementById('frequency-display');
    
    let isPaused = false;
    let currentValue = 70; // Varsayılan başlangıç değeri
    let needleInterval; // Dinamik hareket için zamanlayıcı

    // --- YENİ FONKSİYON: Local Storage'dan ayarları yükler ---
    function loadSettings() {
        const savedVolume = localStorage.getItem('ritimAppVolume');
        const savedPaused = localStorage.getItem('ritimAppPaused');

        if (savedVolume !== null) {
            currentValue = parseInt(savedVolume);
            volumeSlider.value = currentValue;
        }

        if (savedPaused !== null) {
            isPaused = (savedPaused === 'true');
        }
    }

    // --- YENİ FONKSİYON: Local Storage'a ayarları kaydeder ---
    function saveSettings() {
        localStorage.setItem('ritimAppVolume', currentValue.toString());
        localStorage.setItem('ritimAppPaused', isPaused.toString());
    }

    // Kadran İğnesi Güncelleme Fonksiyonu
    function updateNeedle(value) {
        const minAngle = -60;
        const maxAngle = 60;
        const angle = minAngle + (value / 100) * (maxAngle - minAngle);
        gaugeNeedle.style.transform = `rotate(${angle}deg)`;
    }

    // Frekans ve Nota Metnini Günceller
    function updateFrequencyDisplay(value) {
        const minFreq = 380;
        const maxFreq = 500;
        const freqRange = maxFreq - minFreq;
        const currentFreq = minFreq + (value / 100) * freqRange;

        let noteName = "Harmonik";
        if (currentFreq < 400) { noteName = "F#3"; } 
        else if (currentFreq < 430) { noteName = "G4"; } 
        else if (currentFreq < 450) { noteName = "A4"; } 
        else if (currentFreq < 480) { noteName = "B4"; } 
        else { noteName = "C5"; }

        frequencyDisplay.textContent = `${currentFreq.toFixed(2)} Hz - ${noteName}`;
    }
    
    // İğneye Titreşim Ekler
    function startNeedleMovement() {
        if (needleInterval) clearInterval(needleInterval);

        needleInterval = setInterval(() => {
            const drift = (Math.random() * 6) - 3;
            let newValue = currentValue + drift;

            if (newValue < 0) newValue = 0;
            if (newValue > 100) newValue = 100;

            updateNeedle(newValue);
            updateFrequencyDisplay(newValue);

        }, 100);
    }

    function stopNeedleMovement() {
        if (needleInterval) {
            clearInterval(needleInterval);
            needleInterval = null;
            updateNeedle(currentValue); 
            updateFrequencyDisplay(currentValue);
        }
    }
    
    // --- BAŞLANGIÇ İŞLEMLERİ ---
    
    // 1. Ayarları yükle
    loadSettings();

    // 2. Slider'ın görsel durumunu ve başlangıç metnini ayarla
    volumeSlider.style.background = `linear-gradient(to right, var(--color-neon) ${currentValue}%, rgba(245, 245, 245, 0.2) ${currentValue}%)`;
    updateNeedle(currentValue);
    updateFrequencyDisplay(currentValue);
    
    // 3. Pause durumuna göre başlangıç durumunu ayarla
    if (!isPaused) {
        // Eğer aktif durumda kaydedilmişse, hareketi başlat
        activateButton.innerHTML = 'Pause <span class="ml-2">||</span>';
        activateButton.style.backgroundColor = 'var(--color-neon)';
        activateButton.style.color = 'black';
        dataDisplay.innerHTML = `Bağlantı Durumu: <span class="text-white header-glow">AKTİF - RİTİM BAŞLADI!</span>`;
        frequencyDisplay.style.color = 'white';
        startNeedleMovement();
    } else {
        // Eğer duraklatılmış durumda kaydedilmişse, görseli güncelle
        activateButton.innerHTML = 'Aktif <span class="ml-2">▶</span>';
        activateButton.style.backgroundColor = 'var(--color-light-form)';
        activateButton.style.color = 'var(--color-bg-deep)';
        dataDisplay.innerHTML = `Bağlantı Durumu: <span class="text-yellow-400 glow-text-sm">DURAKLATILDI.</span>`;
        frequencyDisplay.style.color = 'gray';
        stopNeedleMovement(); // Hareketi durdur
    }
    
    // --- OLAY DİNLEYİCİLERİ ---

    activateButton.addEventListener('click', () => {
        isPaused = !isPaused;
        
        if (isPaused) {
            stopNeedleMovement();
            activateButton.innerHTML = 'Aktif <span class="ml-2">▶</span>';
            activateButton.style.backgroundColor = 'var(--color-light-form)';
            activateButton.style.color = 'var(--color-bg-deep)';
            dataDisplay.innerHTML = `Bağlantı Durumu: <span class="text-yellow-400 glow-text-sm">DURAKLATILDI.</span>`;
            frequencyDisplay.style.color = 'gray';

        } else {
            startNeedleMovement();
            activateButton.innerHTML = 'Pause <span class="ml-2">||</span>';
            activateButton.style.backgroundColor = 'var(--color-neon)';
            activateButton.style.color = 'black';
            dataDisplay.innerHTML = `Bağlantı Durumu: <span class="text-white header-glow">AKTİF - RİTİM BAŞLADI!</span>`;
            frequencyDisplay.style.color = 'white';
        }
        
        // Pause durumunu kaydet
        saveSettings();
    });

    // Ses Şiddeti kaydırıcısı
    volumeSlider.addEventListener('input', (e) => {
        currentValue = parseInt(e.target.value);
        
        // Kaydırıcının doluluk rengini güncelle
        volumeSlider.style.background = `linear-gradient(to right, var(--color-neon) ${currentValue}%, rgba(245, 245, 245, 0.2) ${currentValue}%)`;
        
        // Eğer duraklatılmışsa, iğneyi ve metni sabitle
        if (isPaused) {
            updateNeedle(currentValue); 
            updateFrequencyDisplay(currentValue);
        }
        
        // Ses şiddetini kaydet
        saveSettings();
    });
