<head>
<title>İnteraktif Frekans Ayarlayıcı ve Ses Kontrolü</title>
<style>
/* ------------------------------------- */
/* CSS KODU */
/* ------------------------------------- */
body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* İçeriği dikeyde ortalar */
    height: 100vh; /* Ekranın tamamını kapla */
    margin: 0; /* Kenar boşluklarını sıfırla */
    padding: 0; /* İç boşlukları sıfırla */
    font-family: sans-serif;
    background-color: #f0f0f0;
    /* Yeni Ekleme: Genişliği de zorla */
    width: 100%; 
}


#frequency-display {
    /* em yerine vh (viewport height) kullanıyoruz */
    font-size: 8vh; 
    font-weight: bold;
    color: #34495e;
    margin-bottom: 5vh; /* Kadran ile arasındaki boşluk */
}


/* Kadran Stilleri (Aynı) */
#dial-container {
    position: relative;
    /* Px yerine vmin kullanıyoruz (ekranın %80'i) */
    width: 90vmin; 
    height: 90vmin;
    background-color: #ccc;
    border-radius: 50%;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    cursor: grab;
    touch-action: none;
}


#dial {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(145deg, #e6e6e6, #ffffff);
    display: flex;
    align-items: center;
    justify-content: center;
}

#indicator {
    position: absolute;
    width: 8px;
    height: 80px;
    background-color: #e74c3c;
    transform-origin: bottom center;
    top: 20px;
    left: 50%;
    margin-left: -4px;
    border-radius: 4px;
    transition: transform 0.05s linear;
}

#center-dot {
    width: 20px;
    height: 20px;
    background-color: #34495e;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
}

/* Play/Pause Buton Stili */
#play-pause-btn {
    margin-top: 15px;
    padding: 10px 20px;
    font-size: 1.1em;
    font-weight: bold;
    color: white;
    background-color: #2ecc71; /* Yeşil Play */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
}

#play-pause-btn.paused {
    background-color: #e74c3c; /* Kırmızı Pause */
}
</style>
</head>
<body>

<div id="frequency-display">440.00 Hz - A4</div>

<div id="dial-container">
    <div id="dial">
        <div id="indicator"></div>
    </div>
    <div id="center-dot"></div>
</div>

<button id="play-pause-btn">Pause ⏸️</button>

<div style="margin-top: 20px; width: 250px; text-align: center;">
    <label for="volume-slider" style="font-weight: bold; color: #34495e;">Ses Şiddeti</label>
    <input type="range" id="volume-slider" min="0" max="100" value="50" style="width: 100%;">
</div>

<p style="margin-top: 10px; color: #555; font-size: 0.8em;">Ses gelmiyorsa lütfen telefonunuzun Medya Sesini açın.</p>

<script>
    // ------------------------------------- 
    // JAVASCRIPT KODU
    // ------------------------------------- 
    const A4_FREKANS = 440.0;
    const YARIM_SES_SAYISI = 12 + 9;
    const NOTA_ISIMLERI = ["A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#"];





    let audioContext;
    let oscillator;
    let gainNode; 
    let isPlaying = true; // Sesin çalma durumunu tutar

    let currentAngle = 0;
    let currentFrequency = A4_FREKANS;
    
    const display = document.getElementById('frequency-display');
    const dialContainer = document.getElementById('dial-container');
    const indicator = document.getElementById('indicator');
    const volumeSlider = document.getElementById('volume-slider');
    const playPauseBtn = document.getElementById('play-pause-btn'); // YENİ BUTON

    function setupAudio() {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        oscillator = audioContext.createOscillator();
        oscillator.type = 'sine';
        gainNode = audioContext.createGain();
        
        gainNode.gain.setValueAtTime(volumeSlider.value / 100, audioContext.currentTime); 
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.start();
    }
    setupAudio(); 

    // --- Frekansı Notaya Çevirme Fonksiyonu (Aynı) ---
    function frekansiNotayaCevir(frekans) {
        if (frekans <= 0) return "0.00 Hz - ---";
        
        const n_hesapla = YARIM_SES_SAYISI * Math.log2(frekans / A4_FREKANS);
        const n_tam = Math.round(n_hesapla);

        const nota_indeksi = n_tam % YARIM_SES_SAYISI; 


        const oktav = 4 + Math.floor(n_tam / YARIM_SES_SAYISI);



        const nota_adi = NOTA_ISIMLERI[nota_indeksi];
        return `${frekans.toFixed(2)} Hz - ${nota_adi}${oktav}`;
    }

    // --- Hareket Mantığı (Aynı) ---
    let isDragging = false;
    let center = { x: 0, y: 0 };
    let startAngle = 0;
    let startDragAngle = 0;

    function calculateCenter() {
        const rect = dialContainer.getBoundingClientRect();
        center.x = rect.left + rect.width / 2;
        center.y = rect.top + rect.height / 2;
    }

    function getAngle(x, y) {
        const dx = x - center.x;
        const dy = y - center.y;
        let angle = Math.atan2(dy, dx) * (180 / Math.PI) + 90;
        if (angle < 0) angle += 360;
        return angle;
    }

    function getCoords(e) {
        const point = e.touches ? e.touches[0] : e;
        return { x: point.clientX, y: point.clientY };
    }

    const handleStart = (e) => {
        // Ses bağlamını ilk dokunmada başlat
        if (audioContext.state === 'suspended') {
            audioContext.resume();
            isPlaying = true;
            playPauseBtn.textContent = 'Pause ⏸️';
            playPauseBtn.classList.remove('paused');
        }

        isDragging = true;
        calculateCenter();
        
        if (e.touches) e.preventDefault(); 
        
        const coords = getCoords(e);
        startDragAngle = getAngle(coords.x, coords.y);
        startAngle = currentAngle;
        dialContainer.style.cursor = 'grabbing';
    };

    const handleMove = (e) => {
        if (!isDragging) return;
        if (e.touches) e.preventDefault();
        
        const coords = getCoords(e);
        const currentDragAngle = getAngle(coords.x, coords.y);
        
        let diff = currentDragAngle - startDragAngle;

        if (diff > 180) diff -= 360;
        if (diff < -180) diff += 360;

        currentAngle = startAngle + diff;
        indicator.style.transform = `rotate(${currentAngle}deg)`;

        const deltaFrequency = diff * 0.15; 
        currentFrequency += deltaFrequency;

        if (currentFrequency < 1.0) currentFrequency = 1.0;
        
        // Ses frekansını güncelle
        oscillator.frequency.setValueAtTime(currentFrequency, audioContext.currentTime); 
        
        display.textContent = frekansiNotayaCevir(currentFrequency);
        
        startDragAngle = currentDragAngle;
        startAngle = currentAngle;
    };

    const handleEnd = () => {
        isDragging = false;
        dialContainer.style.cursor = 'grab';
    };
    
    // YENİ FONKSİYON: Play/Pause İşlemi
    const togglePlayPause = () => {
        if (isPlaying) {
            // Pause (Duraklat)
            audioContext.suspend();
            playPauseBtn.textContent = 'Play ▶️';
            playPauseBtn.classList.add('paused');
        } else {
            // Play (Devam Et)
            audioContext.resume();
            playPauseBtn.textContent = 'Pause ⏸️';
            playPauseBtn.classList.remove('paused');
        }
        isPlaying = !isPlaying;
    };
    
    // --- Olay Dinleyicileri ---
    dialContainer.addEventListener('mousedown', handleStart);
    document.addEventListener('mousemove', handleMove);
    document.addEventListener('mouseup', handleEnd);

    dialContainer.addEventListener('touchstart', handleStart);
    document.addEventListener('touchmove', handleMove, { passive: false });
    document.addEventListener('touchend', handleEnd);
    
    volumeSlider.addEventListener('input', (e) => {
        const newVolume = e.target.value / 100; 
        gainNode.gain.setValueAtTime(newVolume, audioContext.currentTime); 
    });
    
    // YENİ DİNLEYİCİ: Play/Pause butonuna basıldığında
    playPauseBtn.addEventListener('click', togglePlayPause);


    display.textContent = frekansiNotayaCevir(currentFrequency);
</script>
</body>